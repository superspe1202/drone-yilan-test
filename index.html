<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>五結農地測繪 - 實測版 V13.0</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: 'Microsoft JhengHei', sans-serif; }
        #map { height: 100vh; width: 100vw; background: #fff; }
        .info-panel {
            position: absolute; top: 20px; right: 20px; width: 280px;
            background: rgba(255, 255, 255, 0.98); padding: 20px; border-radius: 15px;
            z-index: 1000; box-shadow: 0 15px 40px rgba(0,0,0,0.4); border: 3px solid #3498db;
        }
        .result-box { background: #3498db; padding: 20px; border-radius: 12px; margin-top: 15px; text-align: center; color: white; }
        .value { font-size: 3rem; font-weight: 900; display: block; line-height: 1; }
        .unit { font-size: 1.5rem; font-weight: bold; }
        .edge-label span { background: #e74c3c; border: 2px solid white; border-radius: 6px; padding: 2px 4px; font-size: 12px; color: white; font-weight: bold; }
    </style>
</head>
<body>
    <div class="info-panel">
        <h2 style="margin:0; color: #2c3e50; text-align: center;">五結農地精準匹配</h2>
        <div class="result-box">
            <span id="area-val" class="value">0.79</span>
            <span class="unit">分地</span>
            <div style="margin-top: 10px; font-size: 18px;" id="ping-val">231 坪</div>
        </div>
        <p style="margin-top:15px; font-size:12px; color:#2c3e50; font-weight:bold;">
            ✅ 已疊加 591 原始地籍影像<br>
            ✅ 座標位置：五結鄉 (無山區)
        </p>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-geometryutil"></script>
    <script>
        // 定位到五結鄉平原區
        var map = L.map('map', {zoomControl: false}).setView([24.6784, 121.7508], 20);
        
        // 1. 標準道路底圖
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

        // 2. 疊加我們下載的 591 影像 (地籍線)
        L.tileLayer('tiles/{z}/{x}/{y}.png', {
            maxZoom: 20,
            opacity: 0.9
        }).addTo(map);

        var labels = L.layerGroup().addTo(map);
        var vectorLayer = L.geoJSON(null, {
            style: { color: "#e74c3c", weight: 5, fillOpacity: 0.5 },
            onEachFeature: function(feature, layer) {
                var latlngs = layer.getLatLngs()[0];
                var sqm = Math.abs(L.GeometryUtil.geodesicArea(latlngs));
                document.getElementById('area-val').innerText = (sqm * 0.00103102).toFixed(2);
                document.getElementById('ping-val').innerText = Math.floor(sqm * 0.3025) + " 坪";
                
                labels.clearLayers();
                for(var i=0; i<latlngs.length-1; i++) {
                    var p1 = latlngs[i], p2 = latlngs[i+1];
                    var d = map.distance(p1, p2);
                    var mid = L.latLng((p1.lat+p2.lat)/2, (p1.lng+p2.lng)/2);
                    L.marker(mid, {icon: L.divIcon({className: 'edge-label', html: `<span>${d.toFixed(1)}m</span>`, iconAnchor: [25, 10]})}).addTo(labels);
                }
            }
        }).addTo(map);

        // 載入五結鄉提取出的真實農地向量 (ID: 3 from extract_wujie.py)
        const data = {"type": "FeatureCollection", "features": [{"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[121.7508316040039, 24.678529634295426], [121.7508316040039, 24.678400461015325], [121.75083696842194, 24.678400461015325], [121.75083830952644, 24.678399242399475], [121.75083830952644, 24.678398023783625], [121.75083965063095, 24.678398023783625], [121.75084099173546, 24.678396805167775], [121.75084099173546, 24.678395586551925], [121.75084501504898, 24.678395586551925], [121.75084635615349, 24.678394367936075], [121.75084635615349, 24.678393149320225], [121.750847697258, 24.678393149320225], [121.7508490383625, 24.678391930704375], [121.7508490383625, 24.678390712088525], [121.75085306167603, 24.678390712088525], [121.75085440278053, 24.678389493472675], [121.75085440278053, 24.678388274856825], [121.75085574388504, 24.678388274856825], [121.75085708498955, 24.678387056240975], [121.75085708498955, 24.678385837625125], [121.75086110830307, 24.678385837625125], [121.75086244940758, 24.678384619009275], [121.75086244940758, 24.678383400393425], [121.7508664727211, 24.678383400393425], [121.75086781382561, 24.678382181777575], [121.75086781382561, 24.678380963161725], [121.75086915493011, 24.678380963161725], [121.75087049603462, 24.678379744545875], [121.75087049603462, 24.678378525930025], [121.75087451934814, 24.678378525930025], [121.75087586045265, 24.678377307314175], [121.75087586045265, 24.678376088698325], [121.75087720155716, 24.678376088698325], [121.75087854266167, 24.678374870082475], [121.75087854266167, 24.67837365146663], [121.75088256597519, 24.67837365146663], [121.7508839070797, 24.67837243285078], [121.7508839070797, 24.67837121423493], [121.7508852481842, 24.67837121423493], [121.75088658928871, 24.67836999561908], [121.75088658928871, 24.67836877700323], [121.75089061260223, 24.67836877700323], [121.75089195370674, 24.67836755838738], [121.75089195370674, 24.67836633977153], [121.75089597702026, 24.67836633977153], [121.75089731812477, 24.67836512115568], [121.75089731812477, 24.67836390253983], [121.75089865922928, 24.67836390253983], [121.75090000033379, 24.67836268392398], [121.75090000033379, 24.67836146530813], [121.75090402364731, 24.67836146530813], [121.75090536475182, 24.67836024669228], [121.75090536475182, 24.67835902807643], [121.75090670585632, 24.67835902807643], [121.75090804696083, 24.67835780946058], [121.75090804696083, 24.67835659084473], [121.75091207027435, 24.67835659084473], [121.75091341137886, 24.67835537222888], [121.75091341137886, 24.67835415361303], [121.75091743469238, 24.67835415361303], [121.75091877579689, 24.67835293499718], [121.75091877579689, 24.67835171638133], [121.7509201169014, 24.67835171638133], [121.7509214580059, 24.67835049776548], [121.7509214580059, 24.67834927914963], [121.75092548131943, 24.67834927914963], [121.75092682242393, 24.67834806053378], [121.75092682242393, 24.67834684191793], [121.75092816352844, 24.67834684191793], [121.75092950463295, 24.67834562330208], [121.75092950463295, 24.67834440468623], [121.75093352794647, 24.67834440468623], [121.75093486905098, 24.67834318607038], [121.75093486905098, 24.67834196745453], [121.75093621015549, 24.67834196745453], [121.75093755126, 24.67834074883868], [121.75093755126, 24.67833953022283], [121.75094157457352, 24.67833953022283], [121.75094291567802, 24.67833831160698], [121.75094291567802, 24.67833709299113], [121.75094693899155, 24.67833709299113], [121.75094828009605, 24.67833587437528], [121.75094828009605, 24.67833465575943], [121.75094962120056, 24.67833465575943], [121.75095096230507, 24.67833343714358], [121.75095096230507, 24.67833221852773], [121.75095498561859, 24.67833221852773], [121.7509563267231, 24.67833099991188], [121.7509563267231, 24.67832978129603], [121.7509576678276, 24.67832978129603], [121.75095900893211, 24.67832856268018], [121.75095900893211, 24.67832734406433], [121.75096303224564, 24.67832734406433], [121.75096437335014, 24.67832612544848], [121.75096437335014, 24.67832490683263], [121.75096839666367, 24.67832490683263], [121.75096973776817, 24.67832368821678], [121.75096973776817, 24.67832246960093], [121.75097107887268, 24.67832246960093], [121.75097241997719, 24.67832125098508], [121.75097241997719, 24.67832003236923], [121.75097644329071, 24.67832003236923], [121.75097778439522, 24.67831881375338], [121.75097778439522, 24.67831759513753], [121.75097912549973, 24.67831759513753], [121.75098046660423, 24.67831637652168], [121.75098046660423, 24.67831515790583], [121.75098448991776, 24.67831515790583], [121.75098583102226, 24.67831393928998], [121.75098583102226, 24.67831272067413], [121.75098717212677, 24.67831272067413], [121.75098851323128, 24.67831150205828], [121.75098851323128, 24.67831028344243], [121.7509925365448, 24.67831028344243], [121.75099387764931, 24.67830906482658], [121.75099387764931, 24.67830784621073], [121.75099790096283, 24.67830784621073], [121.75099924206734, 24.67830662759488], [121.75099924206734, 24.67830540897903], [121.75100058317184, 24.67830540897903], [121.75100192427635, 24.67830419036318], [121.75100192427635, 24.67830297174733], [121.75100594758987, 24.67830297174733], [121.75100728869438, 24.67830175313148], [121.75100728869438, 24.67830053451563], [121.75100862979889, 24.67830053451563], [121.7510099709034, 24.67829931589978], [121.7510099709034, 24.67829809728393], [121.75101399421692, 24.67829809728393], [121.75101533532143, 24.67829687866808], [121.75101533532143, 24.67829566005223], [121.75101935863495, 24.67829566005223], [121.75102069973946, 24.67829444143638], [121.75102069973946, 24.67829322282053], [121.75102204084396, 24.67829322282053], [121.75102338194847, 24.67829200420468], [121.75102338194847, 24.67829078558883], [121.751027405262, 24.67829078558883], [121.7510287463665, 24.67828956697298], [121.7510287463665, 24.67828834835713], [121.75103008747101, 24.67828834835713], [121.75103142857552, 24.67828712974128], [121.75103142857552, 24.67828591112543], [121.75103545188904, 24.67828591112543], [121.75103679299355, 24.67828469250958], [121.75103679299355, 24.67828347389373], [121.75103813409805, 24.67828347389373], [121.75103947520256, 24.678282255277878], [121.75103947520256, 24.678281036662028], [121.75104349851608, 24.678281036662028], [121.75104483962059, 24.678279818046178], [121.75104483962059, 24.678278599430328], [121.75104886293411, 24.678278599430328], [121.75105020403862, 24.678277380814478], [121.75105020403862, 24.678276162198628], [121.75105154514313, 24.678276162198628], [121.75105288624763, 24.678274943582778], [121.75105288624763, 24.678273724966928], [121.75105690956116, 24.678273724966928], [121.75105825066566, 24.678272506351078], [121.75105825066566, 24.678271287735228], [121.75105959177017, 24.678271287735228], [121.75106093287468, 24.678270069119378], [121.75106093287468, 24.678268850503528], [121.7510649561882, 24.678268850503528], [121.75106629729271, 24.678267631887678], [121.75106629729271, 24.678266413271828], [121.75107032060623, 24.678266413271828], [121.75107166171074, 24.678265194655978], [121.75107166171074, 24.678263976040128], [121.75107300281525, 24.678263976040128], [121.75107434391975, 24.678262757424278], [121.75107434391975, 24.678261538808428], [121.75107836723328, 24.678261538808428], [121.75107970833778, 24.678260320192578], [121.75107970833778, 24.678259101576728], [121.75108104944229, 24.678259101576728], [121.7510823905468, 24.678257882960878], [121.7510823905468, 24.678256664345028], [121.75108641386032, 24.678256664345028], [121.75108775496483, 24.678255445729178], [121.75108775496483, 24.678254227113328], [121.75108909606934, 24.678254227113328], [121.75109043717384, 24.678253008497478], [121.75109043717384, 24.678251789881628], [121.75109446048737, 24.678251789881628], [121.75109580159187, 24.678250571265778], [121.75109580159187, 24.678249352649928], [121.7510998249054, 24.678249352649928], [121.7511011660099, 24.678248134034078], [121.7511011660099, 24.678246915418228], [121.75110250711441, 24.678246915418228], [121.75110384821892, 24.678245696802378], [121.75110384821892, 24.678244478186528], [121.75110787153244, 24.678244478186528], [121.75110921263695, 24.678243259570678], [121.75110921263695, 24.678242040954828], [121.75111055374146, 24.678242040954828], [121.75111189484596, 24.678240822338978], [121.75111189484596, 24.678239603723128], [121.75111591815948, 24.678239603723128], [121.75111725926399, 24.678238385107278], [121.75111725926399, 24.678237166491428], [121.75112128257751, 24.678237166491428], [121.75112262368202, 24.678235947875578], [121.75112262368202, 24.678234729259728], [121.75112396478653, 24.678234729259728], [121.75112530589104, 24.678233510643878], [121.75112530589104, 24.678232292028028], [121.75112932920456, 24.678232292028028], [121.75113067030907, 24.678231073412178], [121.75113067030907, 24.678229854796328], [121.75113201141357, 24.678229854796328], [121.75113335251808, 24.678228636180478], [121.75113335251808, 24.678227417564628], [121.7511373758316, 24.678227417564628], [121.75113871693611, 24.678226198948778], [121.75113871693611, 24.678224980332928], [121.75114005804062, 24.678224980332928], [121.75114139914513, 24.678223761717078], [121.75114139914513, 24.678222543101228], [121.75114542245865, 24.678222543101228], [121.75114676356316, 24.678221324485378], [121.75114676356316, 24.678218887253678], [121.7511735856533, 24.678218887253678], [121.7511735856533, 24.678529634295426], [121.7508316040039, 24.678529634295426]]]}, "properties": {"id": 1}}]};
        vectorLayer.addData(data);
        setTimeout(() => { vectorLayer.getLayers()[0].fire('click'); }, 1500);
    </script>
</body>
</html>
